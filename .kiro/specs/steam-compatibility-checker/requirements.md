# 要件定義書

## 概要

Steam相性診断は、Steam APIを活用してユーザー同士のゲームライブラリを比較し、共通のゲームや相性度を分析するwebアプリケーションです。Next.jsで構築し、Vercelで静的サイトとしてデプロイします。

## 用語集

- **Steam_API**: SteamのWeb APIサービス
- **相性分析システム**: ユーザー間の相性を分析するシステム
- **ゲームライブラリ**: ユーザーのSteamゲームライブラリ
- **ユーザープロフィール**: Steamユーザーのプロフィール情報
- **相性スコア**: 0-100の数値で表される相性度
- **Webアプリケーション**: Next.jsで構築されるフロントエンドアプリケーション

## 要件

### 要件1: Steam認証とプロフィール取得

**ユーザーストーリー:** ユーザーとして、Steamアカウントで認証したい。そうすることで、相性分析のためにゲームライブラリにアクセスできる。また、自分と相手を同列に扱うUIで比較したい。

#### 受入基準

1. ユーザーがSteamログインボタンをクリックしたとき、Webアプリケーションは SteamのOpenID認証にリダイレクトする
2. Steam認証が成功したとき、Webアプリケーションは ユーザーのSteamプロフィール情報を取得する
3. 認証が失敗したとき、Webアプリケーションは 適切なエラーメッセージを表示し、再試行を可能にする
4. Webアプリケーションは 認証されたユーザーのSteam IDをセッションに安全に保存する
5. 認証後、Webアプリケーションは 自分と相手を同列に扱う左右対称なUIを表示する

### 要件2: ゲームライブラリ取得

**ユーザーストーリー:** 認証されたユーザーとして、Steamゲームライブラリを取得したい。そうすることで、相性分析に使用できる。

#### 受入基準

1. ユーザーが認証されたとき、Steam_APIは ユーザーの所有ゲームリストを取得する
2. ゲームリストが取得されたとき、Webアプリケーションは 所有ゲーム数の合計を表示する
3. ユーザーのプロフィールが非公開の場合、Webアプリケーションは ユーザーに通知し、プロフィール公開設定の変更を要求する
4. Webアプリケーションは APIレート制限を適切な再試行メカニズムで優雅に処理する

### 要件3: 相性診断機能

**ユーザーストーリー:** ユーザーとして、自分のゲームライブラリを他のSteamユーザーと比較したい。そうすることで、ゲーミング相性を確認できる。また、両者を対等な立場で比較したい。

#### 受入基準

1. ユーザーが他のSteamユーザーのプロフィールURLまたはSteam IDを入力したとき、相性分析システムは そのユーザーのゲームライブラリを取得する
2. 両方のライブラリが利用可能なとき、相性分析システムは 共通ゲームと相性メトリクスを計算する
3. 相性分析システムは 共有ゲーム、プレイ時間、ゲームジャンルに基づいて相性スコアを生成する
4. 分析が完了したとき、Webアプリケーションは 結果を左右対称な直感的な形式で表示する
5. Webアプリケーションは 自分と相手のプロフィール情報を同じ重要度で表示する

### 要件4: 結果表示とシェア機能

**ユーザーストーリー:** ユーザーとして、詳細な相性結果を左右対称なレイアウトで表示してシェアしたい。そうすることで、友達とゲーミング嗜好について直感的に比較・議論できる。

#### 受入基準

1. 相性分析が完了したとき、Webアプリケーションは 画面中央に相性結果を表示し、左右にユーザープロフィールを配置する
2. Webアプリケーションは 左右対称なレイアウトで両ユーザーの情報を比較しやすく表示する
3. Webアプリケーションは プレイ時間情報付きの共通ゲームを中央エリアに表示する
4. Webアプリケーションは ゲームジャンル嗜好と相性の内訳を視覚的に表示する
5. Webアプリケーションは 相性結果のシェア可能なURLを提供する
6. 結果をシェアするとき、Webアプリケーションは 視覚的に魅力的なサマリーカードを生成する

### 要件5: レスポンシブデザインとパフォーマンス

**ユーザーストーリー:** ユーザーとして、異なるデバイスでアプリケーションがスムーズに動作してほしい。そうすることで、どこでも使用できる。

#### 受入基準

1. Webアプリケーションは デスクトップ、タブレット、モバイルデバイス全体で完全にレスポンシブである
2. ゲームライブラリを読み込むとき、Webアプリケーションは ローディングインジケーターと進捗情報を表示する
3. Webアプリケーションは API呼び出しを最小化し、パフォーマンスを向上させるためにキャッシュを実装する
4. Webアプリケーションは 標準的なブロードバンド接続で3秒以内に初期コンテンツを読み込む

### 要件6: エラーハンドリングとユーザビリティ

**ユーザーストーリー:** ユーザーとして、何か問題が発生したときに明確なフィードバックがほしい。そうすることで、問題の解決方法がわかる。

#### 受入基準

1. Steam APIが利用できないとき、Webアプリケーションは 再試行オプション付きのメンテナンスメッセージを表示する
2. 無効なSteam IDが入力されたとき、Webアプリケーションは 役立つエラーメッセージと入力検証を提供する
3. ネットワークエラーが発生したとき、Webアプリケーションは 指数バックオフによる自動再試行を実装する
4. Webアプリケーションは 非公開プロフィールのユーザーに対して明確な指示を提供する

### 要件7: 静的サイト対応とデプロイメント

**ユーザーストーリー:** 開発者として、アプリケーションをVercelで静的サイトとしてデプロイできるようにしたい。そうすることで、効率的にホスティングできる。

#### 受入基準

1. Webアプリケーションは 静的サイト生成機能を持つNext.jsを使用して構築される
2. 開発環境では、Webアプリケーションは Next.js API Routesを通じてSteam APIにアクセスする
3. 本番環境では、Webアプリケーションは CORSプロキシサービスを通じてSteam APIにアクセスする
4. Webアプリケーションは すべてのユーザーインタラクションに対してクライアントサイドルーティングを実装する
5. Webアプリケーションは バンドルサイズを最適化し、より良いパフォーマンスのためにコード分割を実装する